# main.py

from database.connection import initialize_database
from services.news_service import run_scraper_job, get_20_latest_news, search_news_by_query, edit_news_item
import time

def main():
    # مرحله ۱: راه‌اندازی دیتابیس
    initialize_database()

    # مرحله ۲: اجرای یکباره اسکرپر
    run_scraper_job()
    
    # مرحله ۳: نمایش ۲۰ خبر آخر
    print("\n--- 20 Latest News ---")
    latest_news = get_20_latest_news()
    for news in latest_news:
        print(f"ID: {news['id']}, Title: {news['title']}")

    # مرحله ۴: جستجو در اخبار
    print("\n--- Search Results for 'tech' ---")
    search_results = search_news_by_query('tech')
    for news in search_results:
        print(f"ID: {news['id']}, Title: {news['title']}")

    # مرحله ۵: ویرایش یک خبر
    # فرض می‌کنیم خبر با id = 1 وجود دارد و می‌خواهیم آن را غیرفعال کنیم
    # print("\n--- Updating News Item ---")
    # update_successful = edit_news_item(1, {'is_active': 0})
    # if update_successful:
    #    print("News item with ID 1 updated successfully.")

if _name_ == '_main_':
    main()

    # اگر می‌خواهید اسکرپر به صورت خودکار هر دقیقه اجرا شود، می‌توانید از APScheduler استفاده کنید.
    # به عنوان مثال:
    # from apscheduler.schedulers.background import BackgroundScheduler
    # scheduler = BackgroundScheduler()
    # scheduler.add_job(run_scraper_job, 'interval', minutes=1)
    # scheduler.start()
    # print("Scheduler started. Press Ctrl+C to exit.")
    # try:
    #    while True:
    #        time.sleep(2)
    # except (KeyboardInterrupt, SystemExit):
    #    scheduler.shutdown()